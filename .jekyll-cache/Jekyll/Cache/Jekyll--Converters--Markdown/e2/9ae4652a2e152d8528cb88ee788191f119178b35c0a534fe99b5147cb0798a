I"î<h3 id="ì‹¤ìŠµì—-ì‚¬ìš©í• -sklearn-ëª¨ë“ˆ-ë°-ë©”ì†Œë“œ">ì‹¤ìŠµì— ì‚¬ìš©í•  sklearn ëª¨ë“ˆ ë° ë©”ì†Œë“œ</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">sklearn.model_selection</span>   <span class="kn">import</span> <span class="n">train_test_split</span><span class="p">,</span>  <span class="n">cross_val_predict</span>
<span class="c1">#ë°ì´í„°ì…‹ í›ˆë ¨ìš©, í…ŒìŠ¤íŠ¸ìš© ë¶„ë¦¬/ êµì°¨ê²€ì¦ (ìˆœì„œëŒ€ë¡œ) 
</span><span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span>       <span class="kn">import</span> <span class="n">GaussianNB</span>  
<span class="c1">#Naive_bayesì˜ GaussianNB(ì •ê·œë¶„í¬) ëª¨í˜•
</span><span class="kn">from</span> <span class="nn">sklearn.metrics</span>           <span class="kn">import</span> <span class="n">accuracy_score</span><span class="p">,</span>  <span class="n">precision_score</span><span class="p">,</span>  <span class="n">recall_score</span><span class="p">,</span>  <span class="n">f1_score</span>
<span class="c1">#ì •í™•ë„/ ì •ë°€ë„/ ì¬í˜„ìœ¨/ F1 Score(ì •ë°€ë„ì™€ ì¬í˜„ìœ¨ì˜ ì¡°í™”í‰ê· )
</span><span class="kn">from</span> <span class="nn">sklearn.metrics</span>           <span class="kn">import</span> <span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">average_precision_score</span>
<span class="c1">#ì˜¤ì°¨í–‰ë ¬/ í‰ê· ì •ë°€ë„
</span><span class="kn">from</span> <span class="nn">sklearn.metrics</span>           <span class="kn">import</span> <span class="n">precision_recall_curve</span><span class="p">,</span>  <span class="n">roc_curve</span><span class="p">,</span>  <span class="n">roc_auc_score</span>
<span class="c1">#ì •ë°€ë„ì™€ ì¬í˜„ìœ¨ ê³¡ì„ / ROC ì»¤ë¸Œ/ AUC(Area Under the Curve)
</span></code></pre></div></div>

<ul>
  <li>ì•ì˜ ë‚´ìš© ì—°ê²° ë° ë³µìŠµ</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span> 
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="c1"># ë°ì´í„°ë¥¼ ì½ì–´ë“¤ì´ê³  ê³ ë ¤í•  íŠ¹ì„±ì„ ì„ íƒ 
</span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'./datasets/PimaIndiansDiabetes.csv'</span><span class="p">)</span>
<span class="n">data_subset</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">loc</span><span class="p">[:,[</span><span class="s">'Blood Glucose'</span><span class="p">,</span> <span class="s">'BMI'</span><span class="p">,</span> <span class="s">'Class'</span><span class="p">]]</span>

<span class="c1"># ë°ì´í„° ì •ì œ
</span><span class="n">bg_mask</span> <span class="o">=</span> <span class="n">data_subset</span><span class="p">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s">"Blood Glucose"</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span>
<span class="n">bmi_mask</span> <span class="o">=</span> <span class="n">data_subset</span><span class="p">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s">"BMI"</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span>
<span class="n">clean_data_subset</span> <span class="o">=</span> <span class="n">data_subset</span><span class="p">[</span><span class="n">bg_mask</span> <span class="o">&amp;</span> <span class="n">bmi_mask</span><span class="p">]</span>

<span class="c1"># ì „ì²´ ìƒ˜í”Œ ì¤‘ ë ˆì´ë¸”ì´ 1ì¸ ìƒ˜í”Œì˜ ë¹„ìœ¨ì´ 0.35, 0ì¸ ìƒ˜í”Œì˜ ë¹„ìœ¨ì´ 0.65
</span><span class="p">(</span><span class="n">clean_data_subset</span><span class="p">.</span><span class="n">Class</span><span class="o">==</span><span class="mi">1</span><span class="p">).</span><span class="nb">sum</span><span class="p">()</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">clean_data_subset</span><span class="p">)</span> 

<span class="c1"># í…ŒìŠ¤íŠ¸ ë°ì´í„°ì…‹ ë¶„ë¦¬ (ë ˆì´ë¸”ì˜ ë¹„ìœ¨ì„ ê³ ë ¤í•˜ì—¬ ë°ì´í„°ì…‹ ë¶„ë¦¬)
</span><span class="n">trainD</span><span class="p">,</span> <span class="n">testD</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">clean_data_subset</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">clean_data_subset</span><span class="p">.</span><span class="n">Class</span><span class="p">)</span> <span class="c1">#staratify: ë¹„ìœ¨ì— ë§ì¶°ì„œ í…ŒìŠ¤íŠ¸ ë°ì´í„°ì…‹ ë¶„ë¦¬
</span>
<span class="p">(</span><span class="n">testD</span><span class="p">.</span><span class="n">Class</span><span class="o">==</span><span class="mi">1</span><span class="p">).</span><span class="nb">sum</span><span class="p">()</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">testD</span><span class="p">)</span> <span class="c1"># 0.3509933774834437
</span><span class="p">(</span><span class="n">trainD</span><span class="p">.</span><span class="n">Class</span><span class="o">==</span><span class="mi">1</span><span class="p">).</span><span class="nb">sum</span><span class="p">()</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">trainD</span><span class="p">)</span> <span class="c1">#  0.35108153078202997
</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">trainD</span><span class="p">[[</span><span class="s">'Blood Glucose'</span><span class="p">,</span> <span class="s">'BMI'</span><span class="p">]]</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">trainD</span><span class="p">[</span><span class="s">'Class'</span><span class="p">]</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">testD</span><span class="p">[[</span><span class="s">'Blood Glucose'</span><span class="p">,</span> <span class="s">'BMI'</span><span class="p">]]</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">testD</span><span class="p">[</span><span class="s">'Class'</span><span class="p">]</span>
</code></pre></div></div>

<ul>
  <li>ìœ„ ê³¼ì •ì„  <code class="language-plaintext highlighter-rouge">sklearn.model_selection</code> ëª¨ë“ˆì˜ <code class="language-plaintext highlighter-rouge">cross_val_predict</code>ë©”ì†Œë“œë¥¼ ì´ìš© (<a href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.cross_val_predict.html">API</a>)</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># cross_val_predict ë¥¼ ì´ìš©í•˜ì—¬ ì„ê³—ê°’ì— ë”°ë¥¸ ì •í™•ë„ ë¹„êµ 
</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_val_predict</span>
<span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span> <span class="kn">import</span> <span class="n">GaussianNB</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span>

<span class="n">classifier</span> <span class="o">=</span> <span class="n">GaussianNB</span><span class="p">()</span>

<span class="n">y_val_probs</span> <span class="o">=</span> <span class="n">cross_val_predict</span><span class="p">(</span><span class="n">classifier</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">"predict_proba"</span><span class="p">)</span>
<span class="c1"># ë¶„ë¥˜ê¸°, data_X, data_y, cv=cross-validation generator(ëª‡ê°œë¡œ ë‚˜ëˆ„ì–´ì„œ ê²€ì¦ì„ í•  ê²ƒì¸ì§€), method:default-predict, predict_probaëŠ” í™•ë¥ ì„ ì•Œë ¤ì¤Œ 
</span></code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">y_val_prob1</span> <span class="o">=</span> <span class="n">y_val_probs</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># ìƒ˜í”Œì´ ì£¼ì–´ì§ˆ ë•Œ, ë ˆì´ë¸”ì´ 1ì´ ë  í™•ë¥ ì„ y_trainì™€ ê°™ì€ indexìˆœìœ¼ë¡œ êµ¬í•¨
</span>
<span class="n">thresholds</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">101</span><span class="p">)</span>  <span class="c1"># 0ê³¼ 1ì„ í¬í•¨í•˜ì—¬ [0,1]ì„ 100ë“±ë¶„ 
</span><span class="n">acc</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">thresholds</span><span class="p">:</span>
    <span class="n">y_val_pred</span> <span class="o">=</span> <span class="n">y_val_prob1</span> <span class="o">&gt;=</span> <span class="n">t</span>
    <span class="n">acc</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_val_pred</span><span class="p">))</span>
<span class="n">best_threshold</span> <span class="o">=</span> <span class="n">thresholds</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">acc</span><span class="p">)]</span>

<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"ì •í™•ë„ëŠ” ì„ê³—ê°’ì´ t=</span><span class="si">{</span><span class="n">best_threshold</span><span class="si">}</span><span class="s">ì¼ ë•Œ </span><span class="si">{</span><span class="n">acc</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">acc</span><span class="p">)]</span><span class="o">*</span><span class="mi">100</span> <span class="p">:.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s">%"</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"ì„ê³—ê°’ì´ 0.5ì¼ ë•Œ ì •í™•ë„ëŠ” </span><span class="si">{</span><span class="n">acc</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">thresholds</span><span class="p">).</span><span class="n">index</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)]</span><span class="o">*</span><span class="mi">100</span> <span class="p">:</span> <span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s">%"</span><span class="p">)</span>

<span class="c1">#ì •í™•ë„ëŠ” ì„ê³—ê°’ì´ t=0.64ì¼ ë•Œ 76.21%
#ì„ê³—ê°’ì´ 0.5ì¼ ë•Œ ì •í™•ë„ëŠ” 74.88%
</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">thresholds</span><span class="p">,</span> <span class="n">acc</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">vlines</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s">'r'</span><span class="p">,</span><span class="n">linestyles</span><span class="o">=</span><span class="s">'dashed'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">vlines</span><span class="p">(</span><span class="mf">0.64</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s">'b'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">'dotted'</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/img/posts/ML5_cv.png" alt="accuracy score" /></p>

<h2 id="1-ì˜¤ì°¨-í–‰ë ¬confusion-matrix">1. ì˜¤ì°¨ í–‰ë ¬(confusion matrix)</h2>

<p>:ì‹¤ì œ í´ë˜ìŠ¤ì™€ ì˜ˆì¸¡ í´ë˜ìŠ¤ë¡œ êµ¬ì„±ëœ íšŸìˆ˜ë¥¼ ì •ë¦¬í•œ í‘œ</p>

<blockquote>
  <p>EX) ë ˆì´ë¸”ì´ 0(ìŒì„±),1(ì–‘ì„±)ì¸ ê²½ìš° ì˜¤ì°¨í–‰ë ¬ì€ ë‹¤ìŒê³¼ ê°™ìŒ</p>

  <table>
    <thead>
      <tr>
        <th>Â </th>
        <th>(ì˜ˆì¸¡ëœ) ìŒì„±</th>
        <th>(ì˜ˆì¸¡ëœ) ì–‘ì„±</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><strong>(ì‹¤ì œ)ìŒì„±</strong></td>
        <td><strong>TN</strong></td>
        <td><strong>FP</strong></td>
      </tr>
      <tr>
        <td><strong>(ì‹¤ì œ)ì–‘ì„±</strong></td>
        <td><strong>FN</strong></td>
        <td><strong>TP</strong></td>
      </tr>
    </tbody>
  </table>

</blockquote>

<h3 id="ì˜¤ì°¨í–‰ë ¬-êµ¬í˜„">ì˜¤ì°¨í–‰ë ¬ êµ¬í˜„</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">y_val_pred</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_val_prob1</span> <span class="o">&gt;</span> <span class="n">best_threshold</span><span class="p">)</span>

<span class="c1"># yì˜ ë ˆì´ë¸” ì¢…ë¥˜ê°€ 2ê°œì¸ ê²½ìš°1
</span><span class="k">def</span> <span class="nf">my_confusion_matrix1</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
    <span class="n">tn</span> <span class="o">=</span> <span class="p">((</span><span class="n">y_true</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y_pred</span><span class="o">==</span><span class="mi">0</span><span class="p">)).</span><span class="nb">sum</span><span class="p">()</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="p">((</span><span class="n">y_true</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y_pred</span><span class="o">==</span><span class="mi">1</span><span class="p">)).</span><span class="nb">sum</span><span class="p">()</span>
    <span class="n">fn</span> <span class="o">=</span> <span class="p">((</span><span class="n">y_true</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y_pred</span><span class="o">==</span><span class="mi">0</span><span class="p">)).</span><span class="nb">sum</span><span class="p">()</span>
    <span class="n">tp</span> <span class="o">=</span> <span class="p">((</span><span class="n">y_true</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y_pred</span><span class="o">==</span><span class="mi">1</span><span class="p">)).</span><span class="nb">sum</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">([[</span><span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">],[</span><span class="n">fn</span><span class="p">,</span><span class="n">tp</span><span class="p">]])</span>

<span class="c1"># yì˜ ë ˆì´ë¸” ì¢…ë¥˜ê°€ 2ê°œì¸ ê²½ìš°2
</span><span class="k">def</span> <span class="nf">my_confusion_matrix2</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>  
    <span class="n">cf_mat</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">cf_mat</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">y_true</span> <span class="o">==</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y_pred</span> <span class="o">==</span> <span class="n">j</span><span class="p">)).</span><span class="nb">sum</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">cf_mat</span>
</code></pre></div></div>

<h4 id="sklearnmetrics-ëª¨ë“ˆì˜-confusion_matrix-ì‚¬ìš©">sklearn.metrics ëª¨ë“ˆì˜ confusion_matrix ì‚¬ìš©</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">confusion_matrix</span>

<span class="n">cf_matrix</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_val_pred</span><span class="p">)</span>
<span class="n">cf_matrix</span>
</code></pre></div></div>

<p>ì„¸ ë°©ë²• ëª¨ë‘ ì•„ë˜ì™€ ê°™ì€ ë‹µì„ ì–»ì„ ìˆ˜ ìˆë‹¤.</p>

<p>array([[365,  25],</p>

<p>â€‹      [118,  93]], dtype=int64)</p>

<h2 id="2-ì˜¤ì°¨í–‰ë ¬ì˜-í•´ì„">2. ì˜¤ì°¨í–‰ë ¬ì˜ í•´ì„</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">row_sums</span> <span class="o">=</span> <span class="n">cf_matrix</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>  
<span class="c1"># cf_matrix.sum(axis=1)ì™€ ê°™ì´ keepdims=Falseë¡œ í•´ë„ ì•„ë˜ 
</span>
<span class="n">norm_cf_matrix</span> <span class="o">=</span> <span class="n">cf_matrix</span> <span class="o">/</span> <span class="n">row_sums</span>

<span class="n">norm_cf_matrix</span>
</code></pre></div></div>

<p>array([[0.93589744, 0.06410256],</p>

<p>â€‹       [0.55924171, 0.44075829]])</p>

<h2 id="3-ì •ë°€ë„precision-ì™€-ì¬í˜„ìœ¨recall">3. ì •ë°€ë„(precision) ì™€ ì¬í˜„ìœ¨(recall)</h2>

<ul>
  <li>
    <p>ì •ë°€ë„(precision) =TP / (TP+FP)</p>

    <blockquote>
      <p>ë¬¸ì œì : ì–‘ì„±ì— ëŒ€í•´ ê°€ì¥ ê°•í•œ í™•ì‹ ì´ ë“œëŠ” ìƒ˜í”Œë§Œ ì–‘ì„±ì´ë¼ í•˜ê³  ë‚˜ë¨¸ì§€ëŠ” ìŒì„±ì´ë¼ íŒë‹¨í•˜ëŠ” ë¶„ë¥˜ê¸°ëŠ” ìœ ìš©í•˜ì§€ ì•Šì§€ë§Œ ì •ë°€ë„ëŠ” 1ë¡œ ì™„ë²½í•´ì§„ë‹¤. ì´ ë¬¸ì œë¥¼ ë³´ì™„í•˜ê¸° ìœ„í•´ ì¬í˜„ìœ¨ì´ë¼ëŠ” ì§€í‘œ ì‚¬ìš©</p>
    </blockquote>
  </li>
  <li>ì¬í˜„ìœ¨(recall), ë¯¼ê°ë„(sensitivity),ì§„ì§œ ì–‘ì„± ë¹„ìœ¨(TPR: True Positive Rate) : TP / (TP+FN)</li>
  <li>F1 score: (2 * precison * recall)/(precision+recall) (ì •ë°€ë„ì™€ ì¬í˜„ìœ¨ì˜ ì¡°í™”í‰ê· )</li>
</ul>

<blockquote>
  <p>ìƒí™©ì— ë”°ë¼ ì¬í˜„ìœ¨ì„ ë‹¤ì†Œ í¬ê¸°í•˜ë”ë¼ë„ ì •ë°€ë„ë¥¼ ë†’ì´ëŠ” ê²ƒì´ í•„ìš”í•œ ê²½ìš°ë„ ìˆê³ , ê·¸ ë°˜ëŒ€ ê²½ìš°ë„ ìˆì„ ìˆ˜ ìˆìŒ ( ì´ë¡  ì—°ìŠµë¬¸ì œ 1, 2 ì°¸ê³ )</p>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">precision_score</span><span class="p">,</span> <span class="n">recall_score</span><span class="p">,</span> <span class="n">f1_score</span>

<span class="n">thresholds_1</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y_val_prob1</span><span class="p">)</span>
<span class="n">precisions_1</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">recalls_1</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">f1s_1</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">thresholds_1</span><span class="p">:</span>
    <span class="n">y_val_pred</span> <span class="o">=</span> <span class="p">(</span><span class="n">y_val_prob1</span> <span class="o">&gt;=</span> <span class="n">t</span><span class="p">)</span>
    <span class="n">precisions_1</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">precision_score</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_val_pred</span><span class="p">))</span>
    <span class="n">recalls_1</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">recall_score</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_val_pred</span><span class="p">))</span>
    <span class="n">f1s_1</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">f1_score</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_val_pred</span><span class="p">))</span>

<span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>    
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">thresholds_1</span><span class="p">,</span> <span class="n">precisions_1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">'r'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">"precision"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">thresholds_1</span><span class="p">,</span> <span class="n">recalls_1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">'b'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">"recall"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">thresholds_1</span><span class="p">,</span> <span class="n">f1s_1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s">'g'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">"f1"</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s">"center right"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>  
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">"threshold"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>         
</code></pre></div></div>

<p><img src="/img/posts/ML5_precision and recall.png" alt="precision, recall and F1" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">thresholds_1</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">thresholds_1</span> <span class="o">&gt;=</span><span class="mf">0.5</span><span class="p">)]</span>
<span class="c1">#0.5014972167017477 ì„ê³„ê°’ 0.5 ì´ìƒì—ì„œ ê°€ì¥ í° ì„ê³„ê°’
</span>
<span class="k">print</span><span class="p">(</span><span class="n">precisions_1</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">thresholds_1</span> <span class="o">&gt;=</span><span class="mf">0.5</span><span class="p">)])</span>
<span class="k">print</span><span class="p">(</span><span class="n">recalls_1</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">thresholds_1</span> <span class="o">&gt;=</span><span class="mf">0.5</span><span class="p">)])</span>

<span class="c1">#0.6851851851851852
#0.5260663507109005
</span>
<span class="c1"># ì •ë°€ë„ì™€ ì¬í˜„ìœ¨ì´ ê°™ì•„ì§€ëŠ” ì„ê³—ê°’
</span><span class="n">pr_eq_t</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">precisions_1</span><span class="p">)</span><span class="o">-</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">recalls_1</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">thresholds_1</span><span class="p">[</span><span class="n">pr_eq_t</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">precisions_1</span><span class="p">[</span><span class="n">pr_eq_t</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">recalls_1</span><span class="p">[</span><span class="n">pr_eq_t</span><span class="p">])</span>

<span class="c1">#0.3912079171353838
#0.6303317535545023
#0.6303317535545023
</span></code></pre></div></div>

<h3 id="sklearnmetrics-ëª¨ë“ˆì˜-precision_recall-curve">sklearn.metrics ëª¨ë“ˆì˜ precision_recall-curve</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">precision_recall_curve</span>

<span class="n">precisions_2</span><span class="p">,</span> <span class="n">recalls_2</span><span class="p">,</span> <span class="n">thresholds_2</span> <span class="o">=</span> <span class="n">precision_recall_curve</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_val_prob1</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">thresholds_2</span><span class="p">,</span> <span class="n">precisions_2</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s">'r'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">"precision"</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">thresholds_2</span><span class="p">,</span> <span class="n">recalls_2</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s">'b'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">"recall"</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s">"center right"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>  
<span class="n">plt</span><span class="p">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">"threshold"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> 
</code></pre></div></div>

<p><img src="/img/posts/ML5_pr2.png" alt="precision, recall" /></p>

<h2 id="4-ì¢‹ì€-ì •ë°€ë„ì¬í˜„ìœ¨-ê· í˜•ì„-ì„ íƒí•˜ëŠ”-ë°©ë²•-prê³¡ì„ ">4. ì¢‹ì€ ì •ë°€ë„/ì¬í˜„ìœ¨ ê· í˜•ì„ ì„ íƒí•˜ëŠ” ë°©ë²•-PRê³¡ì„ </h2>

<ul>
  <li>
    <p>ì¬í˜„ìœ¨ì— ëŒ€í•œ ì •ë°€ë„ ê³¡ì„ ì„ ê·¸ë ¤ì„œ ë¬¸ì œ ì„ íƒì— ë§ëŠ” ì„ê³„ê°’ ì„ íƒ</p>
  </li>
  <li>
    <p>ì¼ë°˜ì ìœ¼ë¡œ ì •ë°€ë„ê°€ ê¸‰ê²©í•˜ê²Œ ë–¨ì–´ì§€ê¸° ì§ì „ì„ ì •ë°€ë„.ì¬í˜„ìœ¨ ê· í˜•ìœ¼ë¡œ ì„ íƒ</p>
  </li>
  <li>
    <p>ì„œë¡œ ë‹¤ë¥¸ ë‘ ëª¨ë¸ì„ ë¹„êµí•´ì„œ ì„ íƒí•˜ëŠ” ìƒí™©ì—ì„œëŠ” PRê³¡ì„  ì•„ë˜ ë„“ì´ê°€ í° ëª¨ë¸ì´ ì¢‹ì€ ëª¨ë¸</p>

    <blockquote>
      <p>PR ê³¡ì„  ë„“ì´ êµ¬í•  ë•Œ <code class="language-plaintext highlighter-rouge">sklearn.metric</code> ëª¨ë“ˆì˜ <code class="language-plaintext highlighter-rouge">average_precision_score</code>ë¥¼ ì´ìš©</p>
    </blockquote>
  </li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="p">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">recalls_2</span><span class="p">,</span> <span class="n">precisions_2</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="/img/posts/ML5_PR curve.png" alt="PR curve" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">average_precision_score</span>

<span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"PR ê³¡ì„  ì•„ë˜ì˜ ë„“ì´ëŠ” </span><span class="si">{</span><span class="n">average_precision_score</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_val_prob1</span><span class="p">)</span> <span class="p">:</span> <span class="mf">0.2</span><span class="n">f</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
<span class="c1">#PR ê³¡ì„  ì•„ë˜ì˜ ë„“ì´ëŠ”  0.68
</span></code></pre></div></div>

<p>Reference</p>

<p>ê¸°ê³„í•™ìŠµ_í•˜ê¸¸ì°¬ êµìˆ˜ë‹˜ ìˆ˜ì—…ì„ ë°”íƒ•ìœ¼ë¡œ ê³µë¶€í•œ ë‚´ìš©ì…ë‹ˆë‹¤.</p>
:ET